# 2-1 まずはテキストエディタの紹介
本ではTeraPadが紹介されてますね．
確かにWindowsでプログラミングするときTeraPadは結構便利です．
でもここではvimを押して参りたいと思います．
えまっくす...？ちょっと何行ってるかよく分かりませんね(戦争).
というわけでinstall.shでもvimを入れるようにしておきますね(ニッコリ).

# 2-2 さて開発再開
はい．というわけでやっていきましょう．
DBで生の機械語を配置しているだけだと可読性が皆無なので，アセンブラの命令に書き換えていきます．

以下，簡単に命令の解説

ORG:
	プログラムの開始アドレス(読み込まれる予定のアドレス)を指定する命令．
	ブートセクタが読み込まれるアドレスは0x7c00-0x7dffなので，ここでは0x7c00を指定する．
	なんでこのアドレスなのかはIBMのおじさん(おじいさん?)に聞いてください(い つ も の)．

JMP:
	gotoのようなもの．

MOV:
	代入命令．"MOV	DEST,SRC"のように書く．
	DEST <- SRC のように値の代入を行う．
	SRC,DESTはレジスタや任意のアドレスのメモリを指定できる．

ADD:
	足し算を行う命令．
	DEST <- DEST + SRC

CMP:
	比較命令．2つの値(これもレジスタだったり任意のアドレスのメモリが指定できる)を比較する．
	比較した結果はフラグレジスタに記録され，その後の命令で使用できる．

JE:
	"jump if equal"の略．CMPで比較した結果が等しければジャンプする．

INT:
	ソフトウェア割り込み命令．
	ここではBIOSの関数呼び出しと等価．
	0x10番の関数はビデオカード制御に関する関数．

HLT:
	CPUを停止させる命令．
	プロセッサはHALT状態になり，基本的には復帰することはない(ただし，一部の割り込みを除く)．

# 2-3 ブートセクタだけを作るように整理
helloos.nasをipl.nasに改名．
	IPL: initial program loader
ipl.nasをnaskでアセンブル，ブートセクタだけのipl.binを作る．
イメージファイルhelloos.imgはedimgを使って，空のディスクイメージfdimg0at.tek(正確には空のディスクイメージをtek圧縮したもの)を読み込み，その先頭512バイトにipl.binを書き込んでhelloos.imgを出力する．
コンパイルからテスト実行までの手順は，
```
$ ./asm.sh
$ ./makeimg.sh
$ ./run.sh
```
になりました．

# 2-4 今後のためにMakefile導入
コンパイルしたりテスト実行したりするのにいちいちシェルスクリプトを実行するのは面倒で，しかも依存関係を考えてなんてくれません．
そこで，Makefileを使います．
Makefileはかしこいバッチファイルのようなもので，依存関係を記述できます．
例えば，
```
ipl.bin : ipl.nas Makefile
	nask ipl.nas ipl.bin ipl.lst
```
のように書くと，ipl.binがipl.nasとMakefileに依存し，```nask ipl.nas ipl.bin ipl.lst```というコマンドを実行することで生成できる，というルールになります．
あるファイルを生成しようとした時に，そのファイルが依存しているファイルが存在していなければ，依存しているファイルを生成するコマンドが実行されてからコマンドが実行されます．便利ですね．
また，Makefileでは変数を使用出来る(というか，チューリング完全なのでプログラミング言語とも言える？)ので，今回はパスの指定をちょっと読みやすくしています．
あと，Makefileで実行するコマンドの前の部分は空白何個とかではなく，必ずタブなので注意してください．
